<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      padding: 0;
      margin: 0;
      height: 2000px;
    }

    .small img {
      width: 50px;
      height: 50px;
      box-sizing: border-box;
      transition: border 0.3s;
    }

    .middle {
      width: 200px;
      height: 200px;
      border: 1px solid orange;
      position: relative;
    }

    .middle img {
      width: 200px;
      height: 200px;
    }

    .middle .layer {
      display: none;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background-color: rgba(0, 0, 0, 0.5);
      position: absolute;
      left: 0;
      top: 0;
      cursor: move;
      overflow: auto;
    }

    .large {
      width: 200px;
      height: 200px;
      border: 1px solid blue;
      background: url(./assets/images/1.webp) no-repeat center/100%;
      background-size: 400px 400px;
      display: none;
    }

    .active {
      border: 2px solid green;
    }
  </style>
</head>

<body>
  <div class="small">
    <img class="active" src="./assets/images/1.webp" alt="">
    <img src="./assets/images/2.webp" alt="">
    <img src="./assets/images/3.webp" alt="">
  </div>
  <div class="middle">
    <img src="./assets/images/1.webp" alt="">
    <div class="layer"></div>
  </div>

  <div class="large"></div>

  <script>
    // 1. 获取三个盒子
    const small = document.querySelector('.small')
    const middle = document.querySelector('.middle')
    const large = document.querySelector('.large')

    // 2. 鼠标滑过小盒子的图片，切换中盒子中的图片
    small.addEventListener('mouseover', function (e) {
      if (e.target.tagName === 'IMG') {
        small.querySelector('.active').classList.remove('active')
        e.target.classList.add('active')
        middle.querySelector('img').src = e.target.src
        large.style.backgroundImage = `url(${e.target.src})`
      }
    })

    // 3. 鼠标滑过中盒子，大盒子显示放大
    let Timer
    function show() {
      clearTimeout(Timer)
      large.style.display = 'block'
    }
    function close() {
      Timer = setTimeout(() => {
        large.style.display = 'none'
      }, 200);
    }
    middle.addEventListener('mouseenter', show)
    middle.addEventListener('mouseleave', close)
    large.addEventListener('mouseenter', show)
    large.addEventListener('mouseleave', close)

    // 4. 鼠标滑过中盒子，显示/隐藏 黑色遮罩层
    const layer = document.querySelector('.layer')
    middle.addEventListener('mouseenter', function () {
      layer.style.display = 'block'
    })
    middle.addEventListener('mouseleave', function () {
      layer.style.display = 'none'
    })

    // 5. 移动遮罩层，将实时鼠标坐标赋予遮罩层
    middle.addEventListener('mousemove', (e) => {
      let leftDistance = e.pageX - middle.getBoundingClientRect().left - document.documentElement.scrollLeft
      let topDistance = e.pageY - middle.getBoundingClientRect().top - document.documentElement.scrollTop
      // 控制遮罩层只在中盒子内移动
      if (leftDistance >= 0 && leftDistance <= 200 && topDistance >= 0 && topDistance <= 200) {
        let lastX = 0
        let lastY = 0
        if (leftDistance >= 0 && leftDistance <= 30) {
          lastX = 0
        } else if (leftDistance > 30 && leftDistance < 170) {
          lastX = leftDistance - 30
        } else {
          lastX = 140
        }
        if (topDistance >= 0 && topDistance <= 30) {
          lastY = 0
        } else if (topDistance > 30 && topDistance < 170) {
          lastY = topDistance - 30
        } else {
          lastY = 140
        }
        layer.style.left = lastX + 'px'
        layer.style.top = lastY + 'px'
        // 大盒子的背景图片要跟随中盒子移动，存在的关系是2倍
        large.style.backgroundPositionX = -2 * lastX + 'px'
        large.style.backgroundPositionY = -2 * lastY + 'px'
      }
    })
  </script>
</body>

</html>