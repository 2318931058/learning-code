<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="./OL_SDK/include-openlayers-local.js"></script>
    <script src="./libs/gaode.js"></script>
  </head>
  <body>
    <button onclick="showRoadState()">显示实时交通</button>
    <div id="map"></div>
    <script>
      var map = new ol.Map({
        target: "map",
        layers: [gaode_vector],
        view: new ol.View({
          projection: "EPSG:4326",
          center: [114.3, 30.5],
          zoom: 10,
        }),
      });

      let style = new ol.style.Style({
        stroke: new ol.style.Stroke({
          width: 3,
          color: "blue",
        }),
      });
      let source = new ol.source.Vector({
        format: new ol.format.GeoJSON(),
        url: "http://39.103.151.139:8000/gis/road_state",
      });
      let layer = new ol.layer.Vector({
        source,
        style,
      });
      map.addLayer(layer);

      function showRoadState() {
        const features = source.getFeatures();

        features.forEach((item) => {
          let color = null;
          let flow = item.get("flow");
          if (flow <= 1200) {
            color = "green";
          } else if(flow <= 1600){
            color = "orange";
          }else{
            color = 'red'
          }
          let stateStyle = new ol.style.Style({
            stroke: new ol.style.Stroke({
              width: 5,
              color,
            }),
          });
          item.setStyle(stateStyle);
        });
      }
    </script>
  </body>
</html>
