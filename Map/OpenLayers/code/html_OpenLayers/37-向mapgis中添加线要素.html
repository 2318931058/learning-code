<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <script src="./OL_SDK/include-openlayers-local.js"></script>
    <script src="./libs/gaode.js"></script>
  </head>
  <body>
    <button onclick="addLine()">添加线要素</button>
    <div id="map"></div>
    <script>
      var docLayer = new Zondy.Map.Doc("", "doc01", {});
      var map = new ol.Map({
        target: "map",
        layers: [gaode_vector, docLayer],
        view: new ol.View({
          projection: "EPSG:4326",
          center: [114.3, 30.5],
          zoom: 4,
        }),
      });

      function addLine() {
        // 1. 创建一个中地要素：几何信息+样式信息+属性信息
        var pointObj = new Array();
        pointObj[0] = new Zondy.Object.Point2D(114, 30);
        pointObj[1] = new Zondy.Object.Point2D(118, 30);
        var gArc = new Zondy.Object.Arc(pointObj);  // 构成折线的弧段
        var gAnyLine = new Zondy.Object.AnyLine([gArc]);    // 构成线的折线
        var gline = new Zondy.Object.GLine(gAnyLine);   // 设置线要素的几何信息
        var fGeom = new Zondy.Object.FeatureGeometry({ LinGeom: [gline] }); // 设置要素的几何信息

        // 1.2 样式信息
        var clineInfo = new Zondy.Object.CLineInfo({    // 设置添加线要素的图形参数信息
          Color: 1, //线的颜色
          LinStyleID: 0, //线型号
          LinStyleID2: 18, //线型号
          LinWidth: 0.05, //线宽
          Xscale: 10,
          Yscale: 10,
        });
        // 设置要素的图形参数信息
        var graphicInfo = new Zondy.Object.WebGraphicsInfo({
          InfoType: 2,  // 1为点point   2为线LineString   3为面Area
          LinInfo: clineInfo,
        });

        // 1.3 属性信息
        var attValue = ['熊二'];
        
        // 2.1 创建要素
        var newFeature = new Zondy.Object.Feature({
          fGeom: fGeom,
          GraphicInfo: graphicInfo,
          AttValue: attValue,
        });
        newFeature.setFType(2); // 设置要素为线要素

        // 2.2 创建要素集
        var featureSet = new Zondy.Object.FeatureSet();
        var fldNumber = 1; //属性个数
        var fldName = ["name"]; // 字段名称
        var fldType = ["string"];   // 字段类型
        //创建属性结构设置对象
        var cAttStruct = new Zondy.Object.CAttStruct({
          FldName: fldName,
          FldNumber: fldNumber,
          FldType: fldType,
        });
        featureSet.AttStruct = cAttStruct;  // 设置要素数据集的树形结构
        featureSet.addFeature(newFeature);  // 将添加的线要素添加到属性数据集中
        
        // 3. 调用服务添加要素：第一个参数为ig server服务的名称，第二个参数时添加要素所在的图层
        var editDocFeature = new Zondy.Service.EditDocFeature("doc01", 1, {});
        editDocFeature.add(featureSet, onLineSuccess);      // 执行添加要素功能
      }

      function onLineSuccess(data) {
        if (data.succeed) {
          alert("添加线要素成功！");
          docLayer.refresh();
        } else {
          alert("添加线要素失败！");
        }
      }
    </script>
  </body>
</html>
